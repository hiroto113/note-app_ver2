# Phase 4-2: 管理画面カテゴリ管理UI実装 詳細設計書

## 1. 概要
管理画面でカテゴリのCRUD操作を行うためのユーザーインターフェースを実装する。既に実装済みのAPIを活用し、シンプルで効率的なカテゴリ管理画面を構築する。

## 2. 実装仕様

### 2.1 カテゴリ一覧・管理画面 (`/admin/categories`)
- **ファイル**: `src/routes/(admin)/admin/categories/+page.server.ts`, `src/routes/(admin)/admin/categories/+page.svelte`
- **機能**:
  - カテゴリ一覧の表示
  - カテゴリの基本情報表示（名前、説明、作成日、記事数）
  - インライン編集機能（名前・説明の直接編集）
  - カテゴリ削除機能（確認モーダル付き）
  - 新しいカテゴリ作成フォーム
  - カテゴリの並び替え（将来拡張）

### 2.2 カテゴリ詳細画面 (`/admin/categories/[id]`)
- **ファイル**: `src/routes/(admin)/admin/categories/[id]/+page.server.ts`, `src/routes/(admin)/admin/categories/[id]/+page.svelte`
- **機能**:
  - カテゴリの詳細情報表示
  - そのカテゴリに属する記事一覧
  - カテゴリ編集機能
  - 関連記事への直接リンク

## 3. UIコンポーネント設計

### 3.1 カテゴリ管理専用コンポーネント
- `src/lib/components/admin/CategoryList.svelte`: カテゴリ一覧表示
- `src/lib/components/admin/CategoryCard.svelte`: カテゴリ一覧の各項目
- `src/lib/components/admin/CategoryForm.svelte`: カテゴリ作成・編集フォーム
- `src/lib/components/admin/CategoryDeleteModal.svelte`: 削除確認モーダル

### 3.2 再利用可能コンポーネント
- `src/lib/components/ui/Modal.svelte`: 汎用モーダルコンポーネント
- `src/lib/components/ui/ConfirmDialog.svelte`: 確認ダイアログ
- `src/lib/components/ui/InlineEdit.svelte`: インライン編集コンポーネント

## 4. データフロー

### 4.1 カテゴリ一覧取得
1. `/admin/categories` ページ読み込み
2. `+page.server.ts` で `GET /api/admin/categories` を呼び出し
3. 取得したデータを `CategoryList` コンポーネントに渡す
4. `CategoryCard` で各カテゴリを表示

### 4.2 カテゴリ作成フロー
1. カテゴリ一覧画面の「新規作成」ボタンクリック
2. インライン作成フォーム表示
3. フォーム送信時に `POST /api/admin/categories` を呼び出し
4. 成功時は一覧を更新

### 4.3 カテゴリ編集フロー
1. カテゴリ名または説明をクリック
2. インライン編集モードに切り替え
3. 変更内容を `PUT /api/admin/categories` で送信
4. 成功時は表示を更新

### 4.4 カテゴリ削除フロー
1. 削除ボタンクリック
2. 確認モーダル表示（関連記事数を表示）
3. 確認後 `DELETE /api/admin/categories` を呼び出し
4. 成功時は一覧から削除

## 5. インライン編集機能

### 5.1 編集可能フィールド
- カテゴリ名（必須）
- カテゴリ説明（任意）

### 5.2 編集フロー
1. フィールドをクリックで編集モードに切り替え
2. 入力フィールド表示（保存・キャンセルボタン付き）
3. Escキーでキャンセル、Enterキーで保存
4. 外部クリックで自動保存（オプション）

## 6. エラーハンドリング

### 6.1 API エラー
- カテゴリ名重複エラーの表示
- ネットワークエラー時の適切な表示
- 削除時の依存関係エラー（関連記事がある場合）

### 6.2 フォームバリデーション
- カテゴリ名必須チェック
- カテゴリ名文字数制限
- 特殊文字制限

## 7. UI/UXデザイン

### 7.1 レイアウト
```
┌─────────────────────────────────────────┐
│ カテゴリ管理                              │
│ ┌─────────────────┐ [新規作成]           │
│ │ 検索フィルタ      │                      │
│ └─────────────────┘                      │
│                                        │
│ ┌─ カテゴリカード ────────────────────────┐ │
│ │ 📁 プログラミング (15記事)              │ │
│ │    プログラミングに関する記事            │ │
│ │    [編集] [削除]                      │ │
│ └───────────────────────────────────────┘ │
│                                        │
│ ┌─ カテゴリカード ────────────────────────┐ │
│ │ 📁 デザイン (8記事)                    │ │
│ │    UI/UXデザインについて                │ │
│ │    [編集] [削除]                      │ │
│ └───────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 7.2 インタラクション
- ホバー時のカード強調表示
- 編集モード時のフィールドハイライト
- ローディング状態のインジケーター
- 成功・エラー時のトースト通知

## 8. アクセシビリティ

### 8.1 キーボード操作
- Tabキーでの要素間移動
- Enterキーでの編集モード開始
- Escキーでの編集キャンセル

### 8.2 スクリーンリーダー対応
- 適切なARIAラベル
- セマンティックなHTML構造
- フォーカス管理

## 9. パフォーマンス考慮

### 9.1 最適化
- カテゴリ数が多い場合の仮想スクロール（将来拡張）
- インライン編集時のデバウンス処理
- 楽観的更新による応答性向上

## 10. テスト計画

### 10.1 機能テスト
- [ ] カテゴリ一覧が正しく表示される
- [ ] カテゴリ作成が動作する
- [ ] インライン編集が動作する
- [ ] カテゴリ削除が動作する
- [ ] フォームバリデーションが機能する

### 10.2 UI/UXテスト
- [ ] インライン編集が直感的に操作できる
- [ ] 削除確認モーダルが適切に表示される
- [ ] エラーメッセージが分かりやすい

## 11. 関連ドキュメント
- Phase 3 API設計: `doc/designs/phase-3/04_categories-crud-api.md`
- Phase 4-1 記事管理UI: `doc/designs/phase-4/01_admin-posts-ui.md`
- 全体設計: `doc/design.md`