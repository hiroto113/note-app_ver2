---
title: '[Task] メディアアップロードAPIの実装'
labels: 'task,backend,phase-5,security,enhancement'
assignees: ''
---

## タスク概要

管理画面から画像などのメディアファイルをアップロードするためのAPIを実装します。セキュリティを考慮し、ファイルサイズと形式の制限を設けます。

## 背景

記事作成時に画像を挿入できるようにするため、メディアアップロード機能が必要です。セキュリティリスクを最小限に抑えながら、使いやすいアップロード機能を提供します。

## 完了条件

- [ ] `POST /api/admin/upload` エンドポイントの実装
- [ ] ファイルサイズ制限の実装（画像: 5MB、ドキュメント: 10MB）
- [ ] ファイル形式制限の実装（JPEG, PNG, GIF, WebP, SVG, PDF, TXT, MD）
- [ ] ファイル名のサニタイズとUUID化
- [ ] アップロードディレクトリの構造化（年/月）
- [ ] EXIF情報の削除
- [ ] 画像最適化処理
- [ ] メディアメタデータのDB保存
- [ ] レート制限の実装
- [ ] セキュリティテストの実施
- [ ] アップロードUIコンポーネントとの統合

## 技術仕様

- SvelteKit API Routes
- Sharp（画像処理）
- Multer相当の機能（ファイルアップロード）
- UUID生成
- File Type検証

## 関連Issue

- 管理用APIの実装
- Phase 4の管理画面UI実装

## 設計書参照

- `/doc/designs/phase-5/03_media_upload_api.md`
- `/doc/design.md` （全体設計書）

## 見積もり工数

4-5時間

## 注意事項

- アップロードディレクトリの実行権限は必ず無効化すること
- MIMEタイプとマジックナンバーの両方でファイル形式を検証すること
- アップロード履歴をログに記録し、不審な活動を検知できるようにすること
- Vercelデプロイ時のファイル永続化について考慮すること（将来的にはS3等の外部ストレージへの移行を検討）