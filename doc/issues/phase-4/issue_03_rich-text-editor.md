---
name: Feature Request
about: リッチテキストエディタ統合
title: '[Phase4] [feature] リッチテキストエディタ統合'
assignees: 'hiroto113'
labels:
    - 'type:feature'
    - 'scope:frontend'
    - 'priority:medium'
    - 'phase:4'
---

## 1. 目的・背景

記事作成・編集機能の使いやすさを向上させるため、Markdownベースのリッチテキストエディタを統合する。WYSIWYG的な編集体験とMarkdownの柔軟性を両立させる。

## 2. 実装内容・変更点

- [ ] 必要なパッケージのインストール
    - [ ] `codemirror` v6.x
    - [ ] `@codemirror/lang-markdown`
    - [ ] `@codemirror/theme-one-dark`
    - [ ] `@codemirror/view`
    - [ ] `@codemirror/state`
- [ ] エディタコアコンポーネントの作成
    - [ ] `src/lib/components/editor/MarkdownEditor.svelte`
    - [ ] `src/lib/components/editor/MarkdownPreview.svelte`
    - [ ] `src/lib/components/editor/EditorToolbar.svelte`
- [ ] 編集機能の実装
    - [ ] 基本書式設定（太字、斜体、コード、見出し）
    - [ ] リンク・画像挿入機能
    - [ ] リスト・引用ブロック対応
    - [ ] キーボードショートカット対応
- [ ] プレビュー機能の実装
    - [ ] リアルタイムプレビュー
    - [ ] サイドバイサイド表示
    - [ ] プレビューモード切り替え
    - [ ] MDsveXとの一貫性確保

## 3. エディタ機能仕様

### 3.1 基本編集機能

- [ ] **太字** (`**text**`) - Ctrl+B
- [ ] _斜体_ (`*text*`) - Ctrl+I
- [ ] `インラインコード` - Ctrl+`
- [ ] ~~取り消し線~~ (`~~text~~`)
- [ ] 見出し (# ## ###) - Ctrl+1,2,3
- [ ] > 引用ブロック
- [ ] `コードブロック` - Ctrl+Shift+C
- [ ]   - 箇条書きリスト
- [ ]   1. 番号付きリスト

### 3.2 高度な機能

- [ ] [リンク](URL) 挿入 - Ctrl+K
- [ ] ![画像](URL) 挿入
- [ ] テーブル作成（将来拡張）
- [ ] 数式入力（将来拡張）

### 3.3 プレビューモード

- [ ] エディタのみ表示
- [ ] サイドバイサイド表示
- [ ] プレビューのみ表示
- [ ] フルスクリーン編集モード

## 4. 受け入れ基準

- [ ] 記事作成・編集画面でリッチエディタが動作する
- [ ] ツールバーボタンがすべて正常に機能する
- [ ] キーボードショートカットが動作する
- [ ] プレビューがMDsveXと同じ結果を表示する
- [ ] 自動保存機能が動作する（5秒間隔）
- [ ] レスポンシブデザインに対応している
- [ ] エディタのパフォーマンスが良好である

## 5. 統合仕様

### 5.1 既存フォームとの統合

- `PostForm.svelte`の`<textarea>`を`<MarkdownEditor>`に置き換え
- フォームバリデーションとの連携維持
- データバインディングの確保

### 5.2 保存機能

- 自動保存（デバウンス処理、5秒間隔）
- 手動保存（Ctrl+S、保存ボタン）
- 編集状態の視覚的表示

## 6. パフォーマンス要件

- [ ] 初期読み込み時間: 2秒以内
- [ ] 大きなドキュメント（10000文字）でも滑らかな操作
- [ ] プレビュー更新遅延: 500ms以内
- [ ] メモリ使用量の適切な管理

## 7. アクセシビリティ要件

- [ ] キーボードのみでの全操作対応
- [ ] スクリーンリーダー対応（適切なARIA属性）
- [ ] ハイコントラスト表示対応
- [ ] フォーカス管理の適切な実装

## 8. レスポンシブ対応

### 8.1 デスクトップ (1024px+)

- サイドバイサイド表示（エディタ + プレビュー）
- 全ツールバーボタン表示

### 8.2 タブレット (768px-1023px)

- 縦分割レイアウト
- 重要なツールバーボタンのみ表示

### 8.3 スマートフォン (~767px)

- タブ切り替え（編集/プレビュー）
- 最小限のツールバー
- フルスクリーン編集対応

## 9. 将来拡張機能

- [ ] ファイルドラッグ&ドロップ対応
- [ ] 画像アップロード機能
- [ ] テーブル編集サポート
- [ ] 数式入力（KaTeX統合）
- [ ] 図表作成（Mermaid統合）
- [ ] 協力編集機能

## 10. テスト要件

### 10.1 機能テスト

- [ ] 各ツールバーボタンの動作確認
- [ ] キーボードショートカットの動作確認
- [ ] プレビューの正確性確認
- [ ] 自動保存機能の確認

### 10.2 パフォーマンステスト

- [ ] 大きなドキュメントでの動作確認
- [ ] 連続編集時のメモリリーク確認
- [ ] プレビュー更新の応答性確認

### 10.3 クロスブラウザテスト

- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] Edge (最新版)

## 11. 関連Issue/PR

- 関連ドキュメント: `doc/designs/phase-4/03_rich-text-editor.md`
- 依存: Phase 4-1 記事管理UI (エディタ統合先)
- 関連: Phase 2 MDsveX設定 (プレビュー一貫性確保)

## 12. 実装優先度

1. **高**: 基本編集機能、プレビュー機能
2. **中**: ツールバー、キーボードショートカット
3. **低**: 高度な機能、将来拡張機能
